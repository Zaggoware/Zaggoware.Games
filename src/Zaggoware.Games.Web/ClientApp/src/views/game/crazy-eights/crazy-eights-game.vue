<template>
    <div id="crazy-eights-game">
        <form v-if="!connected && canConnect"
              class="connect-form"
              @submit="submitConnectForm">
            <p>
                <label for="name">
                    {{ $translateAndCapitalize('labels.name') }}
                </label>

                <input id="name"
                       v-model="userName"
                       type="text"
                       name="name"
                       maxlength="15"
                       autofocus />
            </p>

            <button type="submit">
                {{ $translateAndCapitalize('buttons.connect') }}
            </button>
        </form>

        <div v-if="connected" class="game">
            <div class="game__container">
                <div class="game__players">
                    <h3>{{ $translateAndCapitalize('titles.players') }}</h3>
                    <ul class="connection-list player-list">
                        <li v-for="player in players"
                            :key="player.connection.id"
                            class="connection-list__item player-list__player"
                            :class="{ 'player-list__player--current': isCurrentPlayer(player) }">
                            {{ player.name }}
                            <span v-if="player.cardsInHand > 0">({{ player.cardsInHand }} {{ $translate('labels.cards') }})</span>
                        </li>
                    </ul>
                </div>

                <div class="game__spectators">
                    <h3>{{ $translateAndCapitalize('titles.spectators') }}</h3>
                    <ul class="connection-list spectator-list">
                        <li v-for="spectator in spectators"
                            :key="spectator.id"
                            class="connection-list__item">
                            {{ spectator.name }}
                        </li>
                    </ul>
                </div>

                <div class="game__table">
                    <div class="game__stockpile">
                        <playing-card v-if="stockpileCount > 0"
                                      :selectable="canDrawCard"
                                      @select="drawCard">
                        </playing-card>
                    </div>

                    <div class="game__discard-pile">
                        <playing-card v-if="discardPileCard !== null"
                                      :rank="discardPileCard.rank"
                                      :suit="discardPileCard.suit">
                        </playing-card>
                    </div>
                </div>

                <div v-if="canPickColorOrSuit"
                     class="game__color-suit-chooser game__modal">
                    <div class="game__modal-container">
                        <div class="game__modal-title">
                            <h3>{{ $translateAndCapitalize('titles.chooseSuit') }}</h3>
                        </div>
                        <div class="game__modal-content">
                            <playing-card v-for="(card, index) in pickColorOrSuitCards"
                                          :key="index"
                                          :rank="card.rank"
                                          :suit="card.suit"
                                          :selectable="canPickColorOrSuit"
                                          @select="pickColorOrSuit">
                            </playing-card>
                        </div>
                    </div>
                </div>

                <div v-if="canStart"
                     class="game__modal">
                    <div class="game__modal-container">
                        <div class="game__modal-content">
                            <button type="button"
                                    class="button game__button game__button--start"
                                    @click="startGame">
                                {{ $translateAndCapitalize('buttons.startGame') }}
                            </button>
                        </div>
                    </div>
                </div>

                <div class="game__player-hand">
                    <h3>{{ $translateAndCapitalize('titles.myCards') }}</h3>

                    <ul class="playing-cards">
                        <li v-for="(card, index) in cardsInHand"
                            :key="index"
                            class="playing-cards__card-item">
                            <playing-card :rank="card.rank"
                                          :suit="card.suit"
                                          :selectable="canPlayCard"
                                          @select="playCard">
                            </playing-card>
                        </li>
                    </ul>

                    <button v-if="canEndTurn"
                            type="button"
                            class="button game__button game__button--end-turn"
                            @click="endTurn">
                        {{ $translateAndCapitalize('buttons.endTurn') }}
                    </button>
                </div>

                <div class="chat">
                    <h3>{{ $translateAndCapitalize('titles.chat') }}</h3>
                    <div class="chat__container">
                        <div ref="chat-messages"
                             class="chat__messages">
                            <ul class="chat__messages-list">
                                <li v-for="message in chatMessages"
                                    :key="message.id"
                                    class="chat-message">
                                    <span class="chat-message__name">{{ message.name }}:</span>
                                    <span class="chat-message__message">{{ message.message }}</span>
                                </li>
                            </ul>
                        </div>
                        <div class="chat__new-message-container">
                            <form class="chat__new-message-form"
                                  @submit="sendChatMessage">
                                <input v-model="newMessage"
                                       type="text"
                                       name="message"
                                       autocomplete="off"
                                       class="chat__new-message" />
                                <button type="submit"
                                        class="button chat__button chat__button--new-message">
                                    {{ $translateAndCapitalize('buttons.send') }}
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<script src="./crazy-eights-game.ts" lang="ts"></script>
<style src="./crazy-eights-game.scss" lang="scss"></style>
